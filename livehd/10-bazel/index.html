
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../06-lnast/">
      
      
        <link rel="next" href="../10b-3rdparty/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.8">
    
    
      
        <title>Bazel build - LiveHD and Pyrope</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.f2e4d321.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Fira Code"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/table.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#bazel-build" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="LiveHD and Pyrope" class="md-header__button md-logo" aria-label="LiveHD and Pyrope" data-md-component="logo">
      
  <img src="../../assets/pyrope5.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LiveHD and Pyrope
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Bazel build
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/masc-ucsc/livehd" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="LiveHD and Pyrope" class="md-nav__button md-logo" aria-label="LiveHD and Pyrope" data-md-component="logo">
      
  <img src="../../assets/pyrope5.png" alt="logo">

    </a>
    LiveHD and Pyrope
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/masc-ucsc/livehd" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LiveHD and Pyrope
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Livehd
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Livehd
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../00-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-memory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Memory and concurrency
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++ API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-lgraph/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LGraph
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-lnast/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LNAST
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Bazel build
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Bazel build
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#release-vs-fastbuild-default-vs-debug" class="md-nav__link">
    <span class="md-ellipsis">
      Release vs fastbuild (default) vs debug
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-the-commands-executed" class="md-nav__link">
    <span class="md-ellipsis">
      See the commands executed
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keep-all-the-files-in-bazel-run-for-debugging" class="md-nav__link">
    <span class="md-ellipsis">
      Keep all the files in bazel run for debugging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-run-fixme-tests" class="md-nav__link">
    <span class="md-ellipsis">
      To run FIXME tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-bazel-targets-starting-from-top-directory" class="md-nav__link">
    <span class="md-ellipsis">
      List bazel targets starting from top directory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-bazel-targets-starting-from-any-directory" class="md-nav__link">
    <span class="md-ellipsis">
      List bazel targets starting from any directory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-files-needed-for-a-given-target" class="md-nav__link">
    <span class="md-ellipsis">
      List files needed for a given target
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-all-the-passes-that-use-core-those-should-be-listed-at-mainbuild-deps" class="md-nav__link">
    <span class="md-ellipsis">
      List all the passes that use core (those should be listed at main/BUILD deps)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clear-out-cache-not-needed-in-most-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Clear out cache (not needed in most cases)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-run-long-tests" class="md-nav__link">
    <span class="md-ellipsis">
      To run LONG tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging-with-bazel" class="md-nav__link">
    <span class="md-ellipsis">
      Debugging with bazel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-create-a-fully-static-binary" class="md-nav__link">
    <span class="md-ellipsis">
      To create a fully static binary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10b-3rdparty/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3rd Party
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../11-pass/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating a Pass
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../12-github/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitHub Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../13-style/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coding Style
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Pyrope
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Pyrope
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/00-hwdesign/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hardware Design
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/01-introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/02-basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic syntax
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/03-bundle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tuples
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/04-variables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Variables and types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/05-assert/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Verification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/05b-statements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Statements
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/06-functions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lambdas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/06b-instantiation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Instantiation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/06c-pipelining/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pipelining
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/07-typesystem/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Type system
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/07b-structtype/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Structural Typing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/08-memories/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Memories
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/09-stdlib/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pyrope std lib
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/10-internals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internals
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/10b-vslang/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vs Other Languages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/11-deprecated/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deprecated or Future
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/12-lnast/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LNAST
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/13-stdlib/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pyrope Standard Library
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#release-vs-fastbuild-default-vs-debug" class="md-nav__link">
    <span class="md-ellipsis">
      Release vs fastbuild (default) vs debug
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-the-commands-executed" class="md-nav__link">
    <span class="md-ellipsis">
      See the commands executed
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keep-all-the-files-in-bazel-run-for-debugging" class="md-nav__link">
    <span class="md-ellipsis">
      Keep all the files in bazel run for debugging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-run-fixme-tests" class="md-nav__link">
    <span class="md-ellipsis">
      To run FIXME tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-bazel-targets-starting-from-top-directory" class="md-nav__link">
    <span class="md-ellipsis">
      List bazel targets starting from top directory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-bazel-targets-starting-from-any-directory" class="md-nav__link">
    <span class="md-ellipsis">
      List bazel targets starting from any directory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-files-needed-for-a-given-target" class="md-nav__link">
    <span class="md-ellipsis">
      List files needed for a given target
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-all-the-passes-that-use-core-those-should-be-listed-at-mainbuild-deps" class="md-nav__link">
    <span class="md-ellipsis">
      List all the passes that use core (those should be listed at main/BUILD deps)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clear-out-cache-not-needed-in-most-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Clear out cache (not needed in most cases)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-run-long-tests" class="md-nav__link">
    <span class="md-ellipsis">
      To run LONG tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging-with-bazel" class="md-nav__link">
    <span class="md-ellipsis">
      Debugging with bazel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-create-a-fully-static-binary" class="md-nav__link">
    <span class="md-ellipsis">
      To create a fully static binary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="bazel-build">Bazel build<a class="headerlink" href="#bazel-build" title="Permanent link">&para;</a></h1>
<p>Bazel is a relatively new build system open sourced by google. The main difference
with traditional Makefiles is that it checks to make sure that dependences are not
lost and the builds are reproducible and hermetic. This document explains how
to use Bazel in the LGraph project.</p>
<p>Build targets are referred to using the syntax <code>//&lt;relative path to BUILD file&gt;:&lt;executable&gt;</code>, where
<code>//</code> is the path of the root livehd directory.</p>
<p>To build the LiveHD shell and supporting libraries, the target would be <code>//main:all</code>.
To build every target in LiveHD (helpful for checking if changes cause compilation failures), the target would be <code>//:...</code>.  For more details on target syntax, see <a href="https://docs.bazel.build/versions/master/guide.html#target-patterns">this</a> page.</p>
<h2 id="release-vs-fastbuild-default-vs-debug">Release vs fastbuild (default) vs debug<a class="headerlink" href="#release-vs-fastbuild-default-vs-debug" title="Permanent link">&para;</a></h2>
<p>For debugging/development use <code>-c dbg</code>, for benchmarking and testing <code>-c opt</code>.</p>
<ul>
<li>
<p>Fast build: no optimization, minimal debugging information (no local variable information), assertions turned on (default)
<div class="highlight"><pre><span></span><code>$ bazel build &lt;target&gt;
</code></pre></div></p>
</li>
<li>
<p>Debug build: some optimization, full debugging information, assertions turned on
<div class="highlight"><pre><span></span><code>$ bazel build -c dbg &lt;target&gt;
</code></pre></div></p>
</li>
</ul>
<p>or use address sanitizer to detect memory leaks
<div class="highlight"><pre><span></span><code>$ bazel build -c dbg --config asan //...
</code></pre></div></p>
<p>or use thread sanitizer to detect data races
<div class="highlight"><pre><span></span><code>$ bazel build -c dbg --config tsan //...
</code></pre></div></p>
<ul>
<li>
<p>Release build: most optimization, no debug symbols, assertions turned off
<div class="highlight"><pre><span></span><code>$ bazel build -c opt &lt;target&gt;
</code></pre></div></p>
</li>
<li>
<p>Benchmarking build: aggressive optimization for the current architecture (binary may not be portable!)
<div class="highlight"><pre><span></span><code>$ bazel build --config=bench &lt;target&gt;
</code></pre></div></p>
</li>
</ul>
<h2 id="see-the-commands-executed">See the commands executed<a class="headerlink" href="#see-the-commands-executed" title="Permanent link">&para;</a></h2>
<p>The bazel '-s' option prints the command executed. The sandbox may still be deleted.</p>
<div class="highlight"><pre><span></span><code>$ bazel build -s //main:all
</code></pre></div>
<h2 id="keep-all-the-files-in-bazel-run-for-debugging">Keep all the files in bazel run for debugging<a class="headerlink" href="#keep-all-the-files-in-bazel-run-for-debugging" title="Permanent link">&para;</a></h2>
<p>Bazel runs process in a sandbox what it is deleted after each run. To preserve it for debugging a failing test.</p>
<div class="highlight"><pre><span></span><code>bazel test --sandbox_debug -c dbg //YOUR_TEST_HERE
</code></pre></div>
<p>Check the failing log, it will show you the sandbox location. You can change directory to it, and debug as usual.</p>
<h2 id="to-run-fixme-tests">To run FIXME tests<a class="headerlink" href="#to-run-fixme-tests" title="Permanent link">&para;</a></h2>
<p>Many times, we have new tests that make the regression fail. We use "fixme" if
the test is a new one and LGraph is still not patched. We want the test in the system,
but we do not want to make fail the regressions.</p>
<p>Those tests are marked with tags "fixme" in the BUILD. E.g:</p>
<div class="highlight"><pre><span></span><code>sh_test(
    name = &quot;my_test.sh&quot;,
    tags = [&quot;fixme&quot;],  # This is a fixme test. It fails, but we should fix it
    srcs = [&quot;tests/pyrope_test.sh&quot;],
</code></pre></div>
<p>To run all the fixme tests
<div class="highlight"><pre><span></span><code>$ bazel test --test_tag_filters &quot;fixme&quot; &lt;target&gt;
</code></pre></div>
To list all the fixme tests (the goal is to have zero)
<div class="highlight"><pre><span></span><code>$ bazel query &#39;attr(tags, fixme, tests(&lt;target&gt;))&#39;
</code></pre></div></p>
<h2 id="list-bazel-targets-starting-from-top-directory">List bazel targets starting from top directory<a class="headerlink" href="#list-bazel-targets-starting-from-top-directory" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>$ bazel query &lt;target&gt;
</code></pre></div>
<h2 id="list-bazel-targets-starting-from-any-directory">List bazel targets starting from any directory<a class="headerlink" href="#list-bazel-targets-starting-from-any-directory" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>$ bazel query &lt;target&gt;
</code></pre></div>
<h2 id="list-files-needed-for-a-given-target">List files needed for a given target<a class="headerlink" href="#list-files-needed-for-a-given-target" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>$ bazel query &quot;deps(&lt;target&gt;)&quot;
</code></pre></div>
<h2 id="list-all-the-passes-that-use-core-those-should-be-listed-at-mainbuild-deps">List all the passes that use core (those should be listed at main/BUILD deps)<a class="headerlink" href="#list-all-the-passes-that-use-core-those-should-be-listed-at-mainbuild-deps" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>$ bazel query &quot;rdeps(//pass/..., //core:all)&quot; | grep pass_
</code></pre></div>
<h2 id="clear-out-cache-not-needed-in-most-cases">Clear out cache (not needed in most cases)<a class="headerlink" href="#clear-out-cache-not-needed-in-most-cases" title="Permanent link">&para;</a></h2>
<p>This command is useful for benchmarking build time, and when system parameters change (the compiler gets upgraded, for example)
<div class="highlight"><pre><span></span><code>$ bazel clean --expunge
</code></pre></div></p>
<h2 id="to-run-long-tests">To run LONG tests<a class="headerlink" href="#to-run-long-tests" title="Permanent link">&para;</a></h2>
<p>In addition to the short tests, there are sets of long tests that are run frequently
but not before every push to main line. The reason is that those are multi-hour
tests.
<div class="highlight"><pre><span></span><code>$ bazel test --test_tag_filters &quot;long1&quot; &lt;target&gt;
</code></pre></div>
There are up to 8 long tests categories (long1, long2, long3...). Each of those
tests groups should last less than 4 hours when running in a dual core machine
(travis or azure).</p>
<p>To list the tests under each tag. E.g., to list all the tests with long1 tag.
<div class="highlight"><pre><span></span><code>$ bazel query &#39;attr(tags, long1, tests(&lt;target&gt;))&#39;
</code></pre></div></p>
<h2 id="debugging-with-bazel">Debugging with bazel<a class="headerlink" href="#debugging-with-bazel" title="Permanent link">&para;</a></h2>
<p>First run the tests to see the failing one. Then run with debug options
the failing test. E.g:
<div class="highlight"><pre><span></span><code>$ bazel run -c dbg //eprp:all
</code></pre></div>
Increase logging level if wanted
<div class="highlight"><pre><span></span><code>$ LGRAPH_LOG=info bazel run -c dbg //eprp:all
</code></pre></div>
To run with gdb
<div class="highlight"><pre><span></span><code>$ bazel build -c dbg //eprp:eprp_test
$ gdb bazel-bin/eprp/eprp_test
(gdb) b Eprp::run
(gdb) r
</code></pre></div>
(lldb is also supported.)</p>
<h2 id="to-create-a-fully-static-binary">To create a fully static binary<a class="headerlink" href="#to-create-a-fully-static-binary" title="Permanent link">&para;</a></h2>
<p>In the cc_binary of the relevant BUILD file, add <code>linkopts = ['-static']</code></p>
<p>Notice that the lgshell still needs the directory inside
<code>bazel-bin/main/lgshell.runfiles when using inou.yosys.\*</code></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["search.suggest", "navigation.sections", "navigation.instant", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
        <script src="../../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
      
    
  </body>
</html>