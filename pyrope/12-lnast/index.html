
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../11-deprecated/">
      
      
        <link rel="next" href="../13-stdlib/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.8">
    
    
      
        <title>LNAST - LiveHD and Pyrope</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.f2e4d321.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Fira Code"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/table.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lnast" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="LiveHD and Pyrope" class="md-header__button md-logo" aria-label="LiveHD and Pyrope" data-md-component="logo">
      
  <img src="../../assets/pyrope5.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LiveHD and Pyrope
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              LNAST
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/masc-ucsc/livehd" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="LiveHD and Pyrope" class="md-nav__button md-logo" aria-label="LiveHD and Pyrope" data-md-component="logo">
      
  <img src="../../assets/pyrope5.png" alt="logo">

    </a>
    LiveHD and Pyrope
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/masc-ucsc/livehd" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LiveHD and Pyrope
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Livehd
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Livehd
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../livehd/00-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../livehd/01-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../livehd/02-usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../livehd/03-memory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Memory and concurrency
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../livehd/04-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++ API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../livehd/05-lgraph/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LGraph
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../livehd/06-lnast/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LNAST
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../livehd/10-bazel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bazel build
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../livehd/10b-3rdparty/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3rd Party
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../livehd/11-pass/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating a Pass
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../livehd/12-github/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitHub Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../livehd/13-style/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coding Style
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Pyrope
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Pyrope
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../00-hwdesign/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hardware Design
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic syntax
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-bundle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tuples
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-variables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Variables and types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-assert/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Verification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05b-statements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Statements
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-functions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lambdas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06b-instantiation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Instantiation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06c-pipelining/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pipelining
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-typesystem/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Type system
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07b-structtype/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Structural Typing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-memories/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Memories
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-stdlib/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pyrope std lib
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-internals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internals
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10b-vslang/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vs Other Languages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../11-deprecated/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deprecated or Future
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    LNAST
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    LNAST
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#variable-names" class="md-nav__link">
    <span class="md-ellipsis">
      Variable names
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tuples" class="md-nav__link">
    <span class="md-ellipsis">
      Tuples
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sticky-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Sticky attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bit-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Bit selection
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#direct-lnastlgraph-call" class="md-nav__link">
    <span class="md-ellipsis">
      Direct LNAST/Lgraph call
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-operators" class="md-nav__link">
    <span class="md-ellipsis">
      Basic operators
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic operators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unary" class="md-nav__link">
    <span class="md-ellipsis">
      Unary
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binary-integer" class="md-nav__link">
    <span class="md-ellipsis">
      Binary integer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binary-boolean" class="md-nav__link">
    <span class="md-ellipsis">
      Binary boolean
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complex-operators" class="md-nav__link">
    <span class="md-ellipsis">
      Complex operators
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complex operators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#binary-integer_1" class="md-nav__link">
    <span class="md-ellipsis">
      Binary integer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binary-logical" class="md-nav__link">
    <span class="md-ellipsis">
      Binary logical
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tupleset-operators" class="md-nav__link">
    <span class="md-ellipsis">
      Tuple/Set operators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tuple-to-operator" class="md-nav__link">
    <span class="md-ellipsis">
      Tuple to operator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#range-operator" class="md-nav__link">
    <span class="md-ellipsis">
      Range operator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-operators" class="md-nav__link">
    <span class="md-ellipsis">
      Type operators
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ifunique-if" class="md-nav__link">
    <span class="md-ellipsis">
      if/unique if
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#match" class="md-nav__link">
    <span class="md-ellipsis">
      match
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scope" class="md-nav__link">
    <span class="md-ellipsis">
      Scope
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whileloopfor" class="md-nav__link">
    <span class="md-ellipsis">
      while/loop/for
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#putsprintformat" class="md-nav__link">
    <span class="md-ellipsis">
      puts/print/format
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lambda-call" class="md-nav__link">
    <span class="md-ellipsis">
      Lambda call
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../13-stdlib/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pyrope Standard Library
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#variable-names" class="md-nav__link">
    <span class="md-ellipsis">
      Variable names
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tuples" class="md-nav__link">
    <span class="md-ellipsis">
      Tuples
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sticky-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Sticky attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bit-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Bit selection
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#direct-lnastlgraph-call" class="md-nav__link">
    <span class="md-ellipsis">
      Direct LNAST/Lgraph call
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-operators" class="md-nav__link">
    <span class="md-ellipsis">
      Basic operators
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic operators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unary" class="md-nav__link">
    <span class="md-ellipsis">
      Unary
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binary-integer" class="md-nav__link">
    <span class="md-ellipsis">
      Binary integer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binary-boolean" class="md-nav__link">
    <span class="md-ellipsis">
      Binary boolean
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complex-operators" class="md-nav__link">
    <span class="md-ellipsis">
      Complex operators
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complex operators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#binary-integer_1" class="md-nav__link">
    <span class="md-ellipsis">
      Binary integer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binary-logical" class="md-nav__link">
    <span class="md-ellipsis">
      Binary logical
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tupleset-operators" class="md-nav__link">
    <span class="md-ellipsis">
      Tuple/Set operators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tuple-to-operator" class="md-nav__link">
    <span class="md-ellipsis">
      Tuple to operator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#range-operator" class="md-nav__link">
    <span class="md-ellipsis">
      Range operator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-operators" class="md-nav__link">
    <span class="md-ellipsis">
      Type operators
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ifunique-if" class="md-nav__link">
    <span class="md-ellipsis">
      if/unique if
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#match" class="md-nav__link">
    <span class="md-ellipsis">
      match
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scope" class="md-nav__link">
    <span class="md-ellipsis">
      Scope
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whileloopfor" class="md-nav__link">
    <span class="md-ellipsis">
      while/loop/for
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#putsprintformat" class="md-nav__link">
    <span class="md-ellipsis">
      puts/print/format
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lambda-call" class="md-nav__link">
    <span class="md-ellipsis">
      Lambda call
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="lnast">LNAST<a class="headerlink" href="#lnast" title="Permanent link">&para;</a></h1>
<p>This document is to showcase some of the Pyrope to LNAST translation. This is
useful to have a more "formal" description of the language semantics.</p>
<h2 id="variable-names">Variable names<a class="headerlink" href="#variable-names" title="Permanent link">&para;</a></h2>
<p>LNAST does not rename variables to be SSA, it relies in a symbol table to track
past entries. Nevertheless, to reduce amount of tracking information when a
variable starts with underscores (<code>___foo</code> or <code>_._foo</code>), the variable can not
be updated, BUT it is still legal to update tuple fields inside <code>___foo</code> like
<code>___foo.bar = 3</code>. Program variables names that do not need SSA (<code>let</code>) can use
<code>_._foo</code> to reduce tracking. Special variable names like the ones needing an
underscore use double tick in the name <code>_foo here</code>. Those are special variables
names that do not allow to use compact tuple representation like <code>foo here.field</code>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Pyrope</label><label for="__tabbed_1_2">LNAST direct</label><label for="__tabbed_1_3">LNAST optimized</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>let x = 3 + 1
var z = 4
`foo x` = x + z + 2
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>plus
  ref ___1
  const 3
  const 1
let
  ref  x
  ref  ___1
var
  ref z
  const 4
plus
  ref ___2
  ref x
  ref z
  const 2
assign
  ref `foo x`
  ref ___2
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>plus
  ref ___1
  const 3
  const 1
let
  ref  x
  ref  ___1
var
  ref z
  const 4
plus
  ref `foo x`
  ref x
  ref z
  const 2
</code></pre></div>
</div>
</div>
</div>
<p>The three LNAST nodes to set values in variables are <code>let</code>/<code>var</code>/<code>assign</code>. Each can have
types and/or attributes.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Pyrope</label><label for="__tabbed_2_2">LNAST</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>let a:u2:[foo] = b:u1:[bar]

x:u2:[foo] = y:u1:[bar]
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>set
  ref a
    prim_type_uint
      const 2
    attr_ref_set
      const foo
      const true
  ref b
    prim_type_uint
      const 2
    attr_check
      const bar
      const true

assign
  ref x
    prim_type_uint
      const 2
    attr_ref_set
      const foo
      const true
  ref y
    prim_type_uint
      const 2
    attr_check
      const bar
      const true
</code></pre></div>
</div>
</div>
</div>
<h2 id="tuples">Tuples<a class="headerlink" href="#tuples" title="Permanent link">&para;</a></h2>
<p>Tuples are "ordered" sequences that can be named. There are LNAST tuple
specific nodes (<code>tup_add</code>, <code>tup_set</code>, <code>tup_get</code>, <code>tup_concat</code>) but in many
cases the direct LNAST operations can handle tuples directly.</p>
<ul>
<li><code>tup_add</code> creates a new tuple with entries</li>
<li><code>tup_set</code> adds/updates a field to an existing tuple.</li>
<li><code>tup_get</code> gets the contents of a tuple entry</li>
<li><code>tup_concat</code> concatenates two or more tuples</li>
</ul>
<p>To indicate the tuple position, identifiers can have <code>:pos:name</code>. For example
<code>x.:3:foo = 2</code> is legal. It is the same as <code>x[3] = 2</code> or <code>x.foo=2</code> and check
that entry <code>3</code> has label <code>foo</code>. This allows to create more compact LNAST.
Direct access in operations like <code>plus</code> behave like a <code>tup_set</code> or <code>tup_get</code>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:4"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><input id="__tabbed_3_3" name="__tabbed_3" type="radio" /><input id="__tabbed_3_4" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Tuple in Pyrope</label><label for="__tabbed_3_2">LNAST direct</label><label for="__tabbed_3_3">LNAST optimized</label><label for="__tabbed_3_4">LNAST Alternative</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>x = 3
a = (b=2, x=x+1, y=self.b+1)
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>assign
  ref      x
  const    3
assign
  ref      ___t1
  const    2
plus
  ref      ___t2
  ref      x
  const    1
plus
  ref      ___t3
  ref      ___t1
  const    1
tup_add
  ref      a
  var
    ref      b
    ref      __t1
  var
    ref      x
    ref      ___t2
  var
    ref      y
    ref      ___t4
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>assign
  ref      x
  const    3
plus
  ref      ___t2
  ref      x
  const    1
plus
  ref      ___t3
  ref      ___t1
  const    1
tup_add
  ref      a
  var
    ref      b
    const   2
  var
    ref      x
    ref      ___t2
  var
    ref      y
    ref      ___t4
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>assign
  ref      x
  const    3
var
  ref      a.0b
  ref      2
plus
  ref      ___t1
  ref      x
  const    1
var
  ref      a.1x
  ref      ___t1
plus
  ref      ___t2
  const    a.0b
  const    1
var
  ref     a.2y
  ref     ___t2
</code></pre></div>
</div>
</div>
</div>
<p><code>tup_set</code> and <code>tup_get</code> can access through several levels in one command.
<code>tup_add</code> does not allow recursive entrances, it requires intermediate tuple
construction. <code>attr_get</code> and <code>attr_set</code> follow the same syntax as
<code>tup_get</code>/<code>tup_set</code>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Pyrope</label><label for="__tabbed_4_2">LNAST</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>x = tup[1].foo[xx]
tup[4].foo[yy] = y

z = (foo=(bar=1))
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>tup_get
  ref x
  ref tup
  const 1
  const foo
  ref xx

tup_set
  ref tup
  const 4
  const foo
  ref yy
  ref y

tup_add
  ref ___1
  var
    ref bar
    const 1

tup_add
  ref z
  var
    ref foo
    ref ___1
</code></pre></div>
</div>
</div>
</div>
<p>Tuples can have a <code>let</code> in declaration to indicate that the field is immutable.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:3"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><input id="__tabbed_5_3" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">Tuple in Pyrope</label><label for="__tabbed_5_2">LNAST direct</label><label for="__tabbed_5_3">LNAST Optimized</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>var a = (b=2, let x=1+1)
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>assign
  ref    ___t1
  const  2
plus
  ref    ___t2
  const  1
  const  1
tup_add:
  ref     a
  var
    ref     b
    ref     __t1
  let
    ref     x
    ref     ___t2
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>var
  ref    a.:0:b
  const  2
plus
  ref    ___2
  const  1
  const  1
let
  ref    a.:1:x
  ref    ___2
</code></pre></div>
</div>
</div>
</div>
<p>Tuple concatenation does not use <code>plus</code> but the <code>tup_concat</code> operator.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:3"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><input id="__tabbed_6_3" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">Tuple in Pyrope</label><label for="__tabbed_6_2">LNAST direct</label><label for="__tabbed_6_3">LNAST optimized</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>var a = (2, 1+1)
let x = a ++ (c=3) ++ 1
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>assign
  ref    ___1
  const  2
plus
  ref    ___2
  const  1
  const  1
tup_add:
  ref    ___33
  ref    ___1
  ref    ___2
var
  ref    a
  ref    ___33
tup_add
  ref    ___3
  const  c
  const  3
tup_concat
  ref    ___4
  ref    a
  ref    ___3
  const  1
let
  ref    x
  ref    ___4
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>var
  ref    a.:0:
  const  2
plus
  ref    ___2
  const  1
  const  1
var
  ref    a.:1:
  ref    ___2
tup_add
  ref    ___3
  const  c
  const  3
tup_concat
  ref    ___4
  ref    a
  ref    ___3
  const  1
let
  ref    x
  ref    ___4
</code></pre></div>
</div>
</div>
</div>
<h2 id="attributes">Attributes<a class="headerlink" href="#attributes" title="Permanent link">&para;</a></h2>
<p>There are 3 main operations with attributes: set, get, check, but 4 types of
LNAST nodes (<code>attr_get</code>/<code>attr_set</code> and <code>attr_ref_set</code>/<code>attr_ref_check</code>).
<code>attr_get</code>/<code>attr_set</code> operate at the root level and have the same syntax as
<code>tup_set</code>/<code>tup_get</code> but the last entry is an attribute name.
<code>attr_ref_set</code>/<code>attr_ref_check</code> are sub-nodes of <code>ref</code>, as such they operate
over the associated <code>ref</code> node destination.</p>
<p><code>attr_ref_check</code> only works comparing equal to a <code>const</code> or <code>ref</code>. More complex
attribute comparisons needs <code>attr_get</code> and <code>casserts</code> to operate. </p>
<p>Attribute set are in left-hand-side of assignments which can also be in tuple entries.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">Pyrope</label><label for="__tabbed_7_2">LNAST direct</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>a::[f=3,b] = 1
x = (y::[z=7]=2, 4)
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>assign
  ref a
    attr_ref_set
      const f
      const 3
    attr_ref_set
      const b
      const true
  const 1

tup_add
  ref ___1
  var
    ref y
      attr_ref_set
        const z
        const 7
    const 2
  const 4

assign
  ref x
  ref ___1
</code></pre></div>
</div>
</div>
</div>
<p>Attribute checks are always right-hand-side. The constraint in all the cases is
that an attribute name can be check against an expression but only 3 basic
comparisons are valid (<code>[attr==(expr)</code> or <code>[attr]</code> or <code>[!attr]</code>). The
expression can not use other attribute fields. If complex relationships must be
checked between attributes a <code>cassert</code> must be used.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:3"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><input id="__tabbed_8_3" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">Pyrope</label><label for="__tabbed_8_2">LNAST option 1</label><label for="__tabbed_8_3">LNAST option 2</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>var x = (let z=x::[!y], 4::[foo])
let y = a::[f==3,b] + 1
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>assign
  ref ___tmp
  const 4

tup_add
  ref ___4
  let
    ref z
    ref x
      attr_ref_check
        const y
        const false
  ref ___tmp
    attr_ref_check
      const foo
      const true
var
  ref x
  ref ___4

plus
  ref ___1
  ref a
    attr_ref_check
      const f
      const 3
    attr_ref_check
      const b
      const true
  const 1
let
  ref y
  ref ___1
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>tup_add
  ref ___4
  let
    ref z
    ref x
      attr_ref_check
        const y
        const false
  const 4

attr_get
  ref ___no_attr_const_check
  const 4
  const foo

fcall
  ref ___0
  ref cassert
  ref ___no_attr_const_check

var
  ref x
  ref ___4

plus
  ref ___1
  ref a
    attr_ref_check
      const f
      const 3
    attr_ref_check
      const b
      const true
  const 1
let
  ref y
  ref ___1
</code></pre></div>
</div>
</div>
</div>
<h3 id="sticky-attributes">Sticky attributes<a class="headerlink" href="#sticky-attributes" title="Permanent link">&para;</a></h3>
<p>Attributes can be sticky or not. A sticky attribute "polutes" or keeps
the attribute to the left-hand-side expression. Non-sticky attributes
do not affect or propagate.</p>
<p>Attributes are not sticky by default, but some like <code>.[debug]</code> is a sticky
attribute. This means that if any of the elements in any operation has a debug
attribute, the result also has a <code>.[debug]</code> attribute. There is no way to
remove these attributes.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:2"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><input id="__tabbed_9_2" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">Pyrope</label><label for="__tabbed_9_2">LNAST</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>let d::[debug] = 3

var a = d + 100

cassert a.[debug]  // debug is sticky
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>let
  ref d
    attr_ref_set
      const debug
      const true
  const 3

plus
  ___tmp
  ref d
  const 100

var
  ref a
  ref ___tmp

attr_get
  ref ___get
  ref a
  const debug

fcall
  ___unused
  ref cassert
  ref ___get
</code></pre></div>
</div>
</div>
</div>
<p>Once a variable gets assigned an attribute, the attribute stays with the
variable and any variables that got a direct copy. The only way to remove it is
with arithmetic operations and/or bit selection.</p>
<div class="highlight"><pre><span></span><code>let foo::[attr1=2] = 3

var foo2 = foo
cassert foo2.[attr1] == 2

let foo3 = foo@[..]
cassert foo3 !has _::[attr1]

var xx = 4
xx::[attr2=5] = 1

let xx2 = xx
cassert xx2.[attr2] == 5
cassert xx2 has _::[attr2]

let xx3 = xx + 0
cassert xx3 !has _::[attr2]
</code></pre></div>
<h2 id="bit-selection">Bit selection<a class="headerlink" href="#bit-selection" title="Permanent link">&para;</a></h2>
<p>Pyrope has several bit selection operations. The default maps <code>get_mask</code> and
<code>set_mask</code> LNAST nodes. One important thing is that both <code>get_mask</code> and
<code>set_mask</code> operate over a MASK. This means that it is a one-hot encoding if a
single bit is operated. The one-hot encoding can be created with a <code>range</code> or
with a <code>shl</code> operator.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:3"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><input id="__tabbed_10_2" name="__tabbed_10" type="radio" /><input id="__tabbed_10_3" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">Pyrope</label><label for="__tabbed_10_2">LNAST direct</label><label for="__tabbed_10_3">LNAST optimized</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>foo@[1,2] = xx
yy = foo@[5] + xx@[1..&lt;4]
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>shl
  ref ___c1
  const 1
  const 1

shl
  ref ___c2
  const 1
  const 2

tup_add
  ref ___t
  ref ___c1
  ref ___c2

set_mask
  ref foo
  ref foo
  ref ___t
  ref xx

range
  ref ___c5
  const 5
  const 5
  const 1

get_mask
  ref ___3
  ref foo
  ref ___c5

range
  ref ___4
  const 1
  const 3
  const 1

get_mask
  ref ___5
  ref xx
  ref ___4

add
  ref yy
  ref ___4
  ref ___5
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>shl
  ref ___t
  const 1
  const 1
  const 2

set_mask
  ref foo
  ref foo
  ref ___t
  ref xx

get_mask
  ref ___3
  ref foo
  const 5

range
  ref ___4
  const 1
  const 3
  const 1

get_mask
  ref ___5
  ref xx
  ref ___4

add
  ref yy
  ref ___4
  ref ___5
</code></pre></div>
</div>
</div>
</div>
<p>It is possible to use a <code>foo@sext[range]</code> to perform a bit selection with sign
extension. The <code>sext</code> LNAST node is equivalent to the Lgraph <code>sext</code> that has 2
inputs. The variable and from what bit to perform sign-extension. This means
that the LNAST translation needs a <code>get_mask</code> and a <code>sext</code> node. The <code>sext</code>,
<code>+</code>, <code>|</code>, <code>^</code> bit selection modifiers can only be applied to right-hand-side
operations.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="11:2"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><input id="__tabbed_11_2" name="__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="__tabbed_11_1">Pyrope</label><label for="__tabbed_11_2">LNAST</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>let t1 = foo@sext[..=4]
let t2 = foo@|[..=4]
let t3 = foo@&amp;[..=4]
let t4 = foo@^[..=4]
let t5 = foo@+[..=4]
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>range
  ref ___r
  const 0
  const 4
  const 1

get_mask
  ref ___t
  ref foo
  ref ___r

sext
  ref ___t1
  ref ___t
  const 4
let
  ref t1
  ref ___t1

reduce_or
  ref ___t2
  ref ___t
let
  ref t2
  ref ___t2

reduce_and       // reduce_and(x) == (sext(x) == -1)
  ref ___t3
  ref ___t
let
  ref t3
  ref ___t3

reduce_xor
  ref ___t4
  ref ___t
let
  ref t4
  ref ___t4

popcount
  ref ___t5
  ref ___t
let
  ref t5
  ref ___t5
</code></pre></div>
</div>
</div>
</div>
<h2 id="direct-lnastlgraph-call">Direct LNAST/Lgraph call<a class="headerlink" href="#direct-lnastlgraph-call" title="Permanent link">&para;</a></h2>
<p>A direct Lgraph call can be done with <code>__cell</code> where <code>cell</code> is the Lgraph cell
like <code>plus</code>, <code>LUT</code>, <code>memory</code>. In LNAST this is translated like a lambda call.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="12:2"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio" /><input id="__tabbed_12_2" name="__tabbed_12" type="radio" /><div class="tabbed-labels"><label for="__tabbed_12_1">Pyrope</label><label for="__tabbed_12_2">LNAST</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>let foo = 3
let bar = 300
let b = __plus(1,2,foo,bar)
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>let
  ref foo
  const 3
let
  ref bar
  const 300
tup_add
  ref ___0
  const 1
  const 2
  ref foo
  ref bar
fcall
  ref b
  ref __plus
  ref ___0
</code></pre></div>
</div>
</div>
</div>
<p>A direct LNAST call can be done calling an LNAST method, where the first entry
is the root LNAST node, and rest follow a tree syntax with strings.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="13:2"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio" /><input id="__tabbed_13_2" name="__tabbed_13" type="radio" /><div class="tabbed-labels"><label for="__tabbed_13_1">Pyrope</label><label for="__tabbed_13_2">LNAST</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>LNAST(&quot;let&quot;, (&quot;ref&quot;, &quot;x&quot;), (&quot;const&quot;, &quot;5&quot;))
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>let
  ref x
  const 5
</code></pre></div>
</div>
</div>
</div>
<h2 id="basic-operators">Basic operators<a class="headerlink" href="#basic-operators" title="Permanent link">&para;</a></h2>
<p>Basic operators are binary or unary operators in Pyrope that have a one-to-one
translation to LNAST nodes.</p>
<h3 id="unary">Unary<a class="headerlink" href="#unary" title="Permanent link">&para;</a></h3>
<ul>
<li><code>!a</code> or <code>not a</code> translates to <code>lnot</code></li>
<li><code>~a</code> translates to <code>not</code></li>
<li><code>-a</code> translates to <code>minus(0,a)</code></li>
</ul>
<h3 id="binary-integer">Binary integer<a class="headerlink" href="#binary-integer" title="Permanent link">&para;</a></h3>
<ul>
<li><code>a + b</code> translates to <code>plus</code></li>
<li><code>a - b</code> translates to <code>minus</code></li>
<li><code>a * b</code> translates to <code>mult</code></li>
<li><code>a / b</code> translates to <code>div</code></li>
<li><code>a &amp; b</code> translates to <code>and</code></li>
<li><code>a | b</code> translates to <code>or</code></li>
<li><code>a ^ b</code> translates to <code>xor</code></li>
<li><code>a &gt;&gt; b</code> translates to <code>sra</code></li>
<li><code>a &lt;&lt; b</code> translates to <code>shl</code></li>
</ul>
<p>There is a <code>mod</code> LNAST operator that performs module operations. It does not
have a direct Pyrope syntax, but it can be called directly <code>__mod(a,b)</code>.</p>
<h3 id="binary-boolean">Binary boolean<a class="headerlink" href="#binary-boolean" title="Permanent link">&para;</a></h3>
<ul>
<li><code>a and b</code> translated to <code>land</code></li>
<li><code>a or b</code> translates to <code>lor</code></li>
</ul>
<h2 id="complex-operators">Complex operators<a class="headerlink" href="#complex-operators" title="Permanent link">&para;</a></h2>
<p>Complex operators are binary operators in Pyrope that require more than one
LNAST statement.</p>
<h3 id="binary-integer_1">Binary integer<a class="headerlink" href="#binary-integer_1" title="Permanent link">&para;</a></h3>
<p>Binary nand (<code>x=a ~&amp; b</code>):
<div class="highlight"><pre><span></span><code>and
  ref ___0
  ref a
  ref b
not
  ref x
  ref ___0
</code></pre></div></p>
<p>Binary nor (<code>x=a ~| b</code>):
<div class="highlight"><pre><span></span><code>or
  ref ___0
  ref a
  ref b
not
  ref x
  ref ___0
</code></pre></div></p>
<p>Binary xor (<code>x=a ~^ b</code>):
<div class="highlight"><pre><span></span><code>xor
  ref ___0
  ref a
  ref b
not
  ref x
  ref ___0
</code></pre></div></p>
<p>Logical shift right (<code>x = a@[..] &gt;&gt; b</code>):
<div class="highlight"><pre><span></span><code>get_mask
  ref ___0
  ref a
sra
  ref x
  ref ___0
  ref b
</code></pre></div></p>
<h3 id="binary-logical">Binary logical<a class="headerlink" href="#binary-logical" title="Permanent link">&para;</a></h3>
<p>Logical implication (<code>x = a implies b</code>):
<div class="highlight"><pre><span></span><code>not
  ref ___0
  ref a
lor
  ref x
  ref ___0
  ref b
</code></pre></div></p>
<p>Logical nand (<code>x = a !and b</code>):
<div class="highlight"><pre><span></span><code>land
  ref ___0
  ref a
  ref b
not
  ref x
  ref ___0
</code></pre></div></p>
<p>Logical nor (<code>x = a !or b</code>):
<div class="highlight"><pre><span></span><code>lor
  ref ___0
  ref a
  ref b
not
  ref x
  ref ___0
</code></pre></div></p>
<p>Logical not implication (<code>x = a !implies b</code>):
<div class="highlight"><pre><span></span><code>not
  ref ___0
  ref b
land
  ref x
  ref a
  ref ___0
</code></pre></div></p>
<p>Short-circuit boolean (<code>and_then</code>/<code>or_else</code>)</p>
<p>The short-circuit boolean prevent expressions from being evaluated. This only
matters if there is a procedure call, but at LNAST it is not possible to know
due to getter overload. As a result, the sequence of statments is translated to
a sequence of nested if statements.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="14:2"><input checked="checked" id="__tabbed_14_1" name="__tabbed_14" type="radio" /><input id="__tabbed_14_2" name="__tabbed_14" type="radio" /><div class="tabbed-labels"><label for="__tabbed_14_1">Pyrope</label><label for="__tabbed_14_2">LNAST</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>a = b and_then c and_then (d or e)
</code></pre></div>
</div>
<div class="tabbed-block"></div>
</div>
</div>
<div class="highlight"><pre><span></span><code>land
  ref ___0
  ref b
  ref c
assign
  ref a
  ref ___0
if
  ref ___0
  stmts
    lor ___1
      ref d
      ref e
    assign
      ref a
      ref ___1
</code></pre></div>
<div class="tabbed-set tabbed-alternate" data-tabs="15:2"><input checked="checked" id="__tabbed_15_1" name="__tabbed_15" type="radio" /><input id="__tabbed_15_2" name="__tabbed_15" type="radio" /><div class="tabbed-labels"><label for="__tabbed_15_1">Pyrope</label><label for="__tabbed_15_2">LNAST</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>a = b or_else c or_else (d and e)
</code></pre></div>
</div>
<div class="tabbed-block"></div>
</div>
</div>
<div class="highlight"><pre><span></span><code>lor
  ref ___0
  ref b
  ref c
assign
  ref a
  ref ___0
if
  ref ___0
  stmts
  stmts  // else only
    land
      ref ___1
      ref d
      ref e
    assign
      ref a
      ref ___1
</code></pre></div>
<h3 id="tupleset-operators">Tuple/Set operators<a class="headerlink" href="#tupleset-operators" title="Permanent link">&para;</a></h3>
<p>The <code>in</code> operator does not have a Lgraph equivalent becuase it is type
dependent: tuple, range, or enumerate. The range and enumerate can get
translated to an AND gate over the bitcode translation, but the tuple check
requires a tuple check.</p>
<div class="highlight"><pre><span></span><code>let tup=(1,2,3)
let ran=1..&lt;5
let enu = enum(a,b=(x,y),c)

cassert 2 in tup
cassert 3 in ran
cassert enu.b.x in enu.b
</code></pre></div>
<p>The resul is a common <code>in</code> LNAST operation that gets different functionality
dependent on the input type.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="16:2"><input checked="checked" id="__tabbed_16_1" name="__tabbed_16" type="radio" /><input id="__tabbed_16_2" name="__tabbed_16" type="radio" /><div class="tabbed-labels"><label for="__tabbed_16_1">Pyrope</label><label for="__tabbed_16_2">LNAST</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>c = a in b
d = a !in b
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>in
  ref c
  ref a
  ref b
not
  ref d
  ref c
</code></pre></div>
</div>
</div>
</div>
<p>There are two tuple concatenate operator  <code>a ++ b</code> and <code>(a,...b)</code>. <code>x=a++b</code> translates to:</p>
<div class="highlight"><pre><span></span><code>tup_concat
  ref x
  ref a
  ref b
</code></pre></div>
<p>The inplace concatenate is equivalent but it has a check (<code>cassert</code>) to detect overlap. After the concatenation,
the fields in <code>a</code> and <code>b</code> should be found in the result <code>x</code> or there was an overlap.</p>
<p><code>x=(a,..b)</code> translates to:
<div class="highlight"><pre><span></span><code>tup_concat
  ref x
  ref a
  ref b
in
  ref ___1
  ref a
  ref x
in
  ref ___2
  ref b
  ref x
land
  ref ___3
  ref ___1
  ref ___2
fcall
  ref ___0
  ref cassert
  ref ___3
</code></pre></div></p>
<h3 id="tuple-to-operator">Tuple to operator<a class="headerlink" href="#tuple-to-operator" title="Permanent link">&para;</a></h3>
<p>The <code>to</code> is an iterator but instead of a range, it creates a tuple.</p>
<p><code>tmp = a to b by c</code> translates to:
<div class="highlight"><pre><span></span><code>to
  ref tmp
  ref a
  ref b
  ref c
</code></pre></div></p>
<p><code>tmp = 3 to b</code> translates to:
<div class="highlight"><pre><span></span><code>to
  ref tmp
  const 3
  ref b
  const 1
</code></pre></div></p>
<h3 id="range-operator">Range operator<a class="headerlink" href="#range-operator" title="Permanent link">&para;</a></h3>
<p>Ranges can be open or closed. The closed ranges have the start/end/step
defined.</p>
<p><code>x = a..&lt;=b by 2</code> translates to:
<div class="highlight"><pre><span></span><code>range
  ref x
  ref a
  ref b
  const 2
</code></pre></div></p>
<p><code>x = a..&lt;=b by 2</code> translates to:
<div class="highlight"><pre><span></span><code>range
  ref x
  ref a
  ref b
  const 2
</code></pre></div></p>
<p><code>x = a..&lt;b</code> translates to:
<div class="highlight"><pre><span></span><code>sub
  ref tmp
  ref b
  ref 1

range
  ref x
  ref a
  ref tmp
  const 1
</code></pre></div></p>
<h3 id="type-operators">Type operators<a class="headerlink" href="#type-operators" title="Permanent link">&para;</a></h3>
<p>To check if a field name or position exists in a tuple, <code>x = a has b</code> translates:
<div class="highlight"><pre><span></span><code>has
  ref x
  ref a
  ref b
</code></pre></div></p>
<p>To check the tuple structure, Pyrope has <code>a does b</code>. It returns true if the
tuple of <code>a</code> a subset of <code>b</code>. <code>x = a does b</code> translates to:
<div class="highlight"><pre><span></span><code>does
  ref x
  ref a
  ref b
</code></pre></div></p>
<p>To check equality of tuples <code>x = a equals b</code> same as <code>x = (a does b) and (b does a)</code>. Translates to:
<div class="highlight"><pre><span></span><code>does
  ref ___0
  ref a
  ref b
does
  ref ___1
  ref b
  ref a
land
  ref x
  ref ___0
  ref ___1
</code></pre></div></p>
<p>The <code>a case b</code> does match operation. <code>a case b</code> same as <code>cassert b does a</code> and
for each <code>b</code> field with a defined value, the value matches <code>a</code> (<code>nil</code>, <code>0sb?</code>
are undefined values). <code>x = a case b</code> translates to:
<div class="highlight"><pre><span></span><code>does
  ref ___0
  ref b
  ref a
fcall
  ref ___1
  ref cassert
  ref ___0
in
  ref x
  ref b
  ref a
</code></pre></div></p>
<p>To perform a nominal type check, the attributes can be accessed directly. <code>x = a is b</code> translates to:
<div class="highlight"><pre><span></span><code>attr_get
  ref ___0
  ref a
  const typename
attr_get
  ref ___1
  ref b
  const typename
eq
  ref x
  ref ___0
  ref ___1
</code></pre></div></p>
<h2 id="ifunique-if">if/unique if<a class="headerlink" href="#ifunique-if" title="Permanent link">&para;</a></h2>
<p>Like many modern languages, <code>if</code> accepts not only a boolean expression but a
sequence of statements. Like C++17, before a condition, there can be a sequence
of statements that can include variable declarations. Pyrope variables initial
statement declarations are visiable in the <code>if</code> and <code>else</code> statements like
C++17 does.</p>
<p>A special constraint from Pyrope is that the initial statements and condition
check can not have side-effects. Hence, they can not have <code>procedure</code> calls,
only <code>function</code> calls.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="17:3"><input checked="checked" id="__tabbed_17_1" name="__tabbed_17" type="radio" /><input id="__tabbed_17_2" name="__tabbed_17" type="radio" /><input id="__tabbed_17_3" name="__tabbed_17" type="radio" /><div class="tabbed-labels"><label for="__tabbed_17_1">Pyrope</label><label for="__tabbed_17_2">Pyrope Equivalent</label><label for="__tabbed_17_3">C++17 equivalent</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>var total=3
if var x=3; x&lt;3 {
  total+=x
}elif var z=3; z&lt;4 {
  total+=x+z
}
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>var total=3
{
  var x=3
  if x&lt;3 {
    total+=x
  }else{
    var z=3
    if z&lt;4 {
      total+=x+z
    }
  }
}
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="n">total</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">total</span><span class="o">+=</span><span class="n">x</span><span class="p">;</span>
<span class="p">}</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">z</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">z</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">total</span><span class="o">+=</span><span class="n">x</span><span class="o">+</span><span class="n">z</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>Pyrope has <code>if</code> and <code>unique if</code>. The difference is that <code>unique if</code> guarantees
that only one of the branch conditions is taken. It is possible to have all the
conditions not taken. This allows synthesis optimizations because it implies
that the condition is a one-hot encoding.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="18:2"><input checked="checked" id="__tabbed_18_1" name="__tabbed_18" type="radio" /><input id="__tabbed_18_2" name="__tabbed_18" type="radio" /><div class="tabbed-labels"><label for="__tabbed_18_1">Pyrope</label><label for="__tabbed_18_2">LNAST</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>if var x=a ; x&lt;3 {
  t = 100+x               // z not in scope
}elif var z = x+c ; z&gt;5 {
  t = 200+z+x             // z and x in scope
}
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>stmts
  var
    ref x
    ref a
  lt
    ref ___1
    ref x
    const 3
  if
    ref ___1
    stmts
      add
        ref t
        const 100
        ref x
    stmts
      add
        ref ___2
        ref x
        ref c
      var
        ref z
        ref ___2
      gt
        ref ___3
        ref z
        const 5
      if
        ref ___3
        stmts
          add
            ref t
            const 200
            ref z
            ref x
</code></pre></div>
</div>
</div>
</div>
<p>The <code>unique if</code> is similar, but all the conditions include and <code>optimize</code>
directive to be checked. This means that the conditions must be checked even if
the <code>else</code> is not reached. This is fine because neither the statements nor the
condition checks are allowed to have side-effects.</p>
<p>An important limitation of <code>unique if</code> is that only the first condition can
have initial statement. It is not allowed to have initialization statements in
the <code>elif</code> conditions.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="19:3"><input checked="checked" id="__tabbed_19_1" name="__tabbed_19" type="radio" /><input id="__tabbed_19_2" name="__tabbed_19" type="radio" /><input id="__tabbed_19_3" name="__tabbed_19" type="radio" /><div class="tabbed-labels"><label for="__tabbed_19_1">Pyrope</label><label for="__tabbed_19_2">Pyrope Equivalent</label><label for="__tabbed_19_3">LNAST</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>unique if a&lt;3 {
  y = 10
}elif a&gt;40 {  // not allowed to do &#39;elif var z=40; a&gt;z&#39;
  y = 20+x
}
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>let tmp1 = a&lt;3
let tmp2 = a&gt;40
let tmp3 = 1&lt;&lt;(tmp1,tmp2)
optimize tmp3@+[..]&lt;=1        // at most one bit set

if tmp1 {
  y = 10
}elif tmp2 {
  y = 20+x
}
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>lt
  ref ___1
  ref z
  const 3
gt
  ref ___2
  ref a
  const 40
shl           // create one-hot encoding
  ref ___3
  const 1
  ref ___1
  ref ___2
popcount
  ref ___4
  ref ___3
le
  ref ___5
  ref ___4
  const 1
fcall
  ref nil
  ref optimize
  ref ___5
if
  ref ___1
  stmts
    assign
      ref y
      const 10
  ref ___2
  stmts
    add
      ref y
      const 20
      ref x
</code></pre></div>
</div>
</div>
</div>
<h2 id="match">match<a class="headerlink" href="#match" title="Permanent link">&para;</a></h2>
<p>The match statement behaves like a <code>unique if</code> but it also checks that at least
one of the paths is taken. This means that if the <code>else</code> exists in the match,
it behaves like a <code>unique if</code>. If the else does not exist, an <code>else { assert
false }</code> is created.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="20:2"><input checked="checked" id="__tabbed_20_1" name="__tabbed_20" type="radio" /><input id="__tabbed_20_2" name="__tabbed_20" type="radio" /><div class="tabbed-labels"><label for="__tabbed_20_1">Pyrope</label><label for="__tabbed_20_2">LNAST</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>var z = 0
match x {
 == 3 { z = 1 }
 in 4..&lt;6 { z = 2 }
}

match x {
 &lt;  5 { z = 1 }
 else { z = 3 }
}
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>var
  ref z
  const 0

eq
  ref ___0
  ref x
  const 3
range
  ref ___2
  const 4
  const 5
in
  ref ___1
  ref x
  ref ___2

shl
  ref ___3
  const 1
  ref ___1
  ref ___2
popcount
  ref ___4
  ref ___3
le
  ref ___5
  ref ___4
  const 1
fcall
  ref nil
  ref optimize
  ref ___5

if
  ref ___1
  stmts
    assign
      ref z
      const 1
  ref ___2
  stmts
    assign
      ref z
      const 2
  stmts
    fcall
      ref ___6
      ref assert
      const false

// 2nd match
lt
  ref ___6
  ref x
  const 5
shl
  ref ___7
  const 1
  ref ___6
popcount
  ref ___8
  ref ___7
le
  ref ___9
  ref ___8
  const 1
fcall
  ref nil
  ref optimize
  ref ___9
if
  ref ___6
  stmts
    assign
      ref z
      const 1
  stmts
    assign
      ref z
      const 3
</code></pre></div>
</div>
</div>
</div>
<h2 id="scope">Scope<a class="headerlink" href="#scope" title="Permanent link">&para;</a></h2>
<p>Like most languages Pyrope has variable scope, but it does not allow variable
shadowing. This section showcases some cases on how the scope is generated.</p>
<p>New variables can have a statement scope for <code>if</code>, <code>while</code>, and <code>match</code>
statements.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="21:2"><input checked="checked" id="__tabbed_21_1" name="__tabbed_21" type="radio" /><input id="__tabbed_21_2" name="__tabbed_21" type="radio" /><div class="tabbed-labels"><label for="__tabbed_21_1">Pyrope</label><label for="__tabbed_21_2">LNAST</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>if var x=3; x&lt;4 {
  cassert x==3
}
while var z=1; x {
  x -= z
}
var z=0
match var x=2 ; z+x {
  == 2 { cassert true  }
  != 7 { cassert true  }
  else { cassert false }
}
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>stmts
  var
    ref x
    const 3
  lt
    ref ___1
    ref x
    const 4
  if
    ref ___1
    stmts
      eq
        ref ___2
        ref x
        const 3
      fcall
        ref ___0
        ref cassert
        ref ___2

stmts
  var
    ref z
    const 1
  loop
    if
      ref x
      stmts
        break
    sub
      ref x
      ref x
      ref z

var
  ref z
  const 0
stmts
  var
    ref x
    const 2
  add
    ref ___3
    ref z
    ref x
  eq
    ref ___t1
    ref ___3
    const 2
  ne
    ref ___t2
    ref ___3
    const 7
  shl           // create one-hot encoding
    ref ___x
    const 1
    ref ___t1
    ref ___t2
  popcount
    ref ___y
    ref ___x
  le
    ref ___z
    ref ___y
    const 1
  fcall
    ref nil
    ref optimize
    ref ___z
  if
    ref ___t1
    stmts
      fcall
        ref ___4
        ref cassert
        const true
    ref ___t2
    stmts
      fcall
        ref ___5
        ref cassert
        const true
    stmts
      fcall
        ref ___6
        ref cassert
        const false
</code></pre></div>
</div>
</div>
</div>
<h2 id="whileloopfor">while/loop/for<a class="headerlink" href="#whileloopfor" title="Permanent link">&para;</a></h2>
<p>Pyrope has <code>loop</code>, <code>while</code>, and <code>for</code> constructs to handle different types of loops.
In all the cases, the loops must be expanded at LNAST compile time. In LNAST, there
is only <code>loop</code> construct.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="22:2"><input checked="checked" id="__tabbed_22_1" name="__tabbed_22" type="radio" /><input id="__tabbed_22_2" name="__tabbed_22" type="radio" /><div class="tabbed-labels"><label for="__tabbed_22_1">Pyrope loop</label><label for="__tabbed_22_2">LNAST</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>loop {
  i += 1
  break when i==3
}
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>loop
  add
    ref i
    ref i
    const 1
  eq
    ref ___1
    ref i
    const 3
  if
    ref ___1
    stmts
      break
</code></pre></div>
</div>
</div>
</div>
<p>The <code>while</code> translates to a <code>loop</code> with a <code>break</code> statement.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="23:2"><input checked="checked" id="__tabbed_23_1" name="__tabbed_23" type="radio" /><input id="__tabbed_23_2" name="__tabbed_23" type="radio" /><div class="tabbed-labels"><label for="__tabbed_23_1">Pyrope while</label><label for="__tabbed_23_2">LNAST</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>while var i=0 ; i!=3 {
  i += 1
}
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>stmts
  var
    ref i
    const 0
  loop
    neq
      ref ___1
      ref i
      const 3
    not
      ref ___2
      ref ___1
    if
      ref ___2
      stmts
        break
</code></pre></div>
</div>
</div>
</div>
<p>The <code>for</code> construct is also a loop, but it can have element, index, and key in the iterator. Also, it can allow a <code>ref</code> to mutate the contents.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="24:4"><input checked="checked" id="__tabbed_24_1" name="__tabbed_24" type="radio" /><input id="__tabbed_24_2" name="__tabbed_24" type="radio" /><input id="__tabbed_24_3" name="__tabbed_24" type="radio" /><input id="__tabbed_24_4" name="__tabbed_24" type="radio" /><div class="tabbed-labels"><label for="__tabbed_24_1">Pyrope for</label><label for="__tabbed_24_2">Pyrope ref for</label><label for="__tabbed_24_3">LNAST for</label><label for="__tabbed_24_4">LNAST ref for</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>for (index,key,value) in enumerate(key(tup)) {
  mycall(value,index,key)
}
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>for value in ref tup {
  mycall(value)
  value = 0
}
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>attr_get
  ref ___tup_size
  ref tup
  const size
gt
  ref ___2
  ref ___tup_size
  const 0
if
  ref ___2
  stmts
    var
      ref value
      ref _
    var
      ref index
      const 0
    var
      ref key
      const &quot;&quot;
    loop
      attr_get
        ref key
        ref tup
        ref index
        const &quot;key&quot;
      tup_get
        ref value
        ref tup
        ref index
      tup_add
        ref ___6
        ref index
        ref key
        ref value
      fcall
        ref ___empty
        ref mycall
        ref ___6
      add
        ref index
        ref index
        const 1
      eq
        ref ___3
        ref ___tup_size
        ref index
      if
        ref ___3
        stmts
          break
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>attr_get
  ref ___tup_size
  ref tup
  const size
gt
  ref ___2
  ref ___tup_size
  const 0
if
  ref ___2
  stmts
    var
      ref value
      ref _
    var
      ref index
      const 0
    var
      ref key
      const &quot;&quot;
    loop
      attr_get
        ref key
        ref tup
        ref index
        const &quot;key&quot;
      tup_get
        ref tup
        ref index
        ref value
      tup_add
        ref ___6
        ref index
        ref key
        ref value
      fcall
        ref ___empty
        ref mycall
        ref ___6
      tup_set
        ref tup
        ref index
        ref value
      add
        ref index
        ref index
        const 1
      eq
        ref ___3
        ref ___tup_size
        ref index
      if
        ref ___3
        stmts
          break
</code></pre></div>
</div>
</div>
</div>
<p>The <code>for</code> comprehensions behave similarly, but the <code>cont</code>/<code>brk</code> statements have
the value that must be concatenated (<code>tup_concat</code>) to the result. If the last
statement is an expression, the value is contatenated.</p>
<h2 id="putsprintformat">puts/print/format<a class="headerlink" href="#putsprintformat" title="Permanent link">&para;</a></h2>
<p>All the string variables must be known at compile time, but it is still OK to
pass strings as arguments to simulation functions that have no side-effects in
the running simulation like <code>puts</code> and <code>print</code>.</p>
<p><code>format</code> uses C++ fmt::format syntax and returns a string, so it must be solved
at compile time. This means that the LNAST passes should have a <code>format</code>
implementation to allow copy propagation to proceed. When format is used, a
single  quote should be used to avoid string interpolation.</p>
<p>The LNAST translation for all these instructions is just a normal function
call. The <code>format</code> must be executed at compile time and propagate/copy as
needed. The <code>puts</code>/<code>print</code> should generate simulation calls but not synthesis
code.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="25:2"><input checked="checked" id="__tabbed_25_1" name="__tabbed_25" type="radio" /><input id="__tabbed_25_2" name="__tabbed_25" type="radio" /><div class="tabbed-labels"><label for="__tabbed_25_1">Pyrope</label><label for="__tabbed_25_2">LNAST</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>let num = 1
let color = &quot;blue&quot;
let extension = &quot;s&quot;

let txt1 = &quot;I have {num} {color} potato{extension}&quot;  // interpolation
let txt2 = format(&#39;I have {:d} {} potato{}&#39;, num, color, extension)
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>let
  ref num
  const 1
let
  ref color
  const blue
let
  ref extension
  const s

tup_add
  ref ___tmp
  const &quot;I have {} {} potato{}&quot;
  ref num
  ref color
  ref extension

fcall
  ref txt1
  ref format
  ref ___tmp

tup_add
  ref ___tmp2
  const &#39;I have {:d} {} potato{}&#39;
  ref num
  ref color
  ref extension

fcall
  ref txt2
  ref format
  ref ___tmp2
</code></pre></div>
</div>
</div>
</div>
<h2 id="lambda-call">Lambda call<a class="headerlink" href="#lambda-call" title="Permanent link">&para;</a></h2>
<p>A lambda call arguments requires do not always require to be named like when a
variable used matches a calling argument. To support the matching while
processing the LNAST, the arguments tuple must be named for all the arguments
unless an argument is an expression.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="26:2"><input checked="checked" id="__tabbed_26_1" name="__tabbed_26" type="radio" /><input id="__tabbed_26_2" name="__tabbed_26" type="radio" /><div class="tabbed-labels"><label for="__tabbed_26_1">Pyrope</label><label for="__tabbed_26_2">LNAST</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>x = fcall(a,b=3,foo,1+2)
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>add
  ref ___t
  const 1
  const 2

tup_add
  ref ___args
  let
    ref a
    ref a
  let
    ref b
    const 3
  let
    ref foo
    ref foo
  ref ___t

fcall
  ref x
  ref fcall
  ref ___args
</code></pre></div>
</div>
</div>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["search.suggest", "navigation.sections", "navigation.instant", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
        <script src="../../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
      
    
  </body>
</html>